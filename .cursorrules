# Cursor Rules для InfoBot

## Git Push Workflow

**КРИТИЧЕСКИ ВАЖНО: ВСЕГДА используй скрипт scripts/git_commit_push.py для всех операций git commit и push!**

Когда пользователь пишет "пуш" или "gei" или "push", выполни:

```
python scripts/git_commit_push.py "Описание изменений"
```

Где "Описание изменений" - это осмысленное сообщение на основе всех изменений, которые были сделаны.
Если изменений много, перечисли основные изменения.

**Что делает скрипт:**
1. Синхронизирует файлы в публичную версию через sync_to_public.py
2. Выполняет git pull с merge в основном репозитории
3. Проверяет наличие изменений
4. Добавляет все файлы (git add -A)
5. Создает commit с указанным сообщением
6. Выполняет push в основной репозиторий
7. Повторяет операции в публичном репозитории InfoBot_Public (если есть изменения)

**НЕ используй ручные команды git add, git commit, git push напрямую! Всегда используй скрипт!**

## Важные замечания:

- **КРИТИЧЕСКИ ВАЖНО: ВСЕГДА используй scripts/git_commit_push.py, а не ручные git команды!**
- НЕ используй git commit -a без явного указания пользователя
- НЕ выполняй git add, git commit, git push вручную - используй скрипт!
- Всегда проверяй статус перед commit (скрипт делает это автоматически)
- Используй осмысленные сообщения коммитов на русском языке
- Если есть конфликты при pull, скрипт сообщит об ошибке
- Если публичный репозиторий не найден, скрипт пропустит эту часть автоматически

## Пример сообщения коммита:

- "Миграция bots.py: замена JSON на БД для хранения состояния ботов"
- "Полная миграция bots.py: все JSON данные перенесены в БД"
- "Исправление ошибки в функции save_bots_state"
- "Добавлена поддержка новой функции X"

## Важное правило для конфигурационных файлов:

**КРИТИЧЕСКИ ВАЖНО:** При обновлении любого конфигурационного файла (например, `bot_engine/bot_config.py`) ВСЕГДА обновляй также его example версию (например, `bot_engine/example.bot_config.py`).

- Example файлы являются эталонными и должны содержать актуальные дефолтные настройки
- При изменении конфига сначала обнови example версию, затем обнови сам конфиг
- Это гарантирует, что новые установки получат актуальные настройки по умолчанию
- Если конфиг не отслеживается в git (в .gitignore), то example версия - единственный способ сохранить дефолтные настройки

**Примеры пар файлов:**
- `bot_engine/bot_config.py` ↔ `bot_engine/example.bot_config.py`
- `app/config.py` ↔ `app/config.example.py` (если есть)
- Любые другие конфиги с example версиями

## КРИТИЧЕСКИ ВАЖНО: Проверка кода после изменений

**ОБЯЗАТЕЛЬНО после КАЖДОГО изменения кода:**

1. **Проверь синтаксис и линтер:**
   - Выполни `read_lints` для всех измененных файлов
   - Убедись, что нет синтаксических ошибок
   - Исправь все предупреждения линтера

2. **Проверь логику изменений:**
   - Убедись, что все используемые переменные определены
   - Проверь, что удаляемые переменные действительно существуют
   - Проверь импорты и зависимости
   - Убедись, что нет неиспользуемых переменных в `del` или других операциях

3. **Проверь контекст использования:**
   - Найди все места, где используется изменяемый код (grep, codebase_search)
   - Убедись, что изменения не сломают другие части кода
   - Проверь, что изменения согласованы с остальным кодом

4. **Проверь edge cases:**
   - Что происходит, если переменная не определена?
   - Что происходит, если функция вызывается в другом контексте?
   - Есть ли обработка исключений для всех возможных ошибок?

**НЕ коммить изменения, пока не убедишься, что:**
- ✅ Нет ошибок линтера
- ✅ Все переменные определены и используются корректно
- ✅ Нет нестыковок с остальным кодом
- ✅ Обработаны все возможные ошибки