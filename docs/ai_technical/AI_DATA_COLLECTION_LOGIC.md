# –õ–æ–≥–∏–∫–∞ —Å–±–æ—Ä–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è AI

**–î–∞—Ç–∞:** 2025-10-17  
**–§–∞–π–ª:** `scripts/ai/collect_historical_data.py`

---

## üéØ –¶–ï–õ–¨

–°–æ–±–∏—Ä–∞—Ç—å **—Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–≤–µ—á–∏** –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏, –∏—Å–∫–ª—é—á–∞—è —Ç–µ–∫—É—â—É—é (–Ω–µ–∑–∞–∫—Ä—ã—Ç—É—é) —Å–≤–µ—á—É.

---

## üîç –ü–û–ß–ï–ú–£ –í–ê–ñ–ù–û –ò–°–ö–õ–Æ–ß–ê–¢–¨ –ù–ï–ó–ê–ö–†–´–¢–´–ï –°–í–ï–ß–ò

### –ü—Ä–æ–±–ª–µ–º–∞ —Å –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–º–∏ —Å–≤–µ—á–∞–º–∏:

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –í—Ä–µ–º—è 10:30, —Å–≤–µ—á–∞ 06:00-12:00 –µ—â—ë –æ—Ç–∫—Ä—ã—Ç–∞

**–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (10:30):**
```
timestamp: 2025-10-17 06:00
close: 50000  # –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (–Ω–µ–ø–æ–ª–Ω–∞—è —Å–≤–µ—á–∞)
```

**–í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ (11:00):**
```
timestamp: 2025-10-17 06:00  # –¢–û–¢ –ñ–ï timestamp
close: 50500  # –ù–æ–≤–∞—è —Ü–µ–Ω–∞ (—Å–≤–µ—á–∞ –≤—Å—ë –µ—â—ë –æ—Ç–∫—Ä—ã—Ç–∞)
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ùå –î–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É —Å–±–æ—Ä–∞–º–∏
- ‚ùå –ú–æ–¥–µ–ª—å –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º–∏

### –†–µ—à–µ–Ω–∏–µ:

‚úÖ **–°–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–≤–µ—á–∏** (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ, –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

---

## üí° –ö–ê–ö –≠–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å–≤–µ—á–∏ (—Å—Ç—Ä–æ–∫–∏ 58-67):

```python
# –ù–∞—á–∏–Ω–∞–µ–º —Å —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
current_time = int(time.time() * 1000)  # –ú–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã

# –í–ê–ñ–ù–û: –ò—Å–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â—É—é (–Ω–µ–∑–∞–∫—Ä—ã—Ç—É—é) —Å–≤–µ—á—É –¥–ª—è 6H
six_hours_ms = 6 * 60 * 60 * 1000  # 21600000 –º—Å

# –û–∫—Ä—É–≥–ª—è–µ–º –≤–Ω–∏–∑ –¥–æ –Ω–∞—á–∞–ª–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∑–∞–∫—Ä—ã—Ç–æ–π —Å–≤–µ—á–∏
end_time = (current_time // six_hours_ms) * six_hours_ms
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:

**–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:** `2025-10-17 10:30:00` (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã: `1729156200000`)

**–†–∞—Å—á—ë—Ç:**
```python
current_time = 1729156200000
six_hours_ms = 21600000

end_time = (1729156200000 // 21600000) * 21600000
         = 80050 * 21600000
         = 1729080000000
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `2025-10-17 06:00:00` (–Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π —Å–≤–µ—á–∏)

**API –≤–µ—Ä–Ω—ë—Ç —Å–≤–µ—á–∏ –î–û 06:00:**
- ‚úÖ `2025-10-17 00:00:00` (–∑–∞–∫—Ä—ã—Ç–∞)
- ‚úÖ `2025-10-16 18:00:00` (–∑–∞–∫—Ä—ã—Ç–∞)
- ‚úÖ `2025-10-16 12:00:00` (–∑–∞–∫—Ä—ã—Ç–∞)
- ‚ùå `2025-10-17 06:00:00` (–æ—Ç–∫—Ä—ã—Ç–∞, –∏—Å–∫–ª—é—á–µ–Ω–∞!)

---

## üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –î–£–ë–õ–ò–ö–ê–¢–û–í

### –õ–æ–≥–∏–∫–∞ `drop_duplicates` (—Å—Ç—Ä–æ–∫–∞ 143):

```python
combined_df = combined_df.drop_duplicates(subset=['timestamp'], keep='last')
```

### `keep='last'` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä:

**–°—Ü–µ–Ω–∞—Ä–∏–π 1:** –°–≤–µ—á–∞ **–∑–∞–∫—Ä—ã–ª–∞—Å—å** –ø–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–±–æ—Ä–∞

**–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å–æ–±—Ä–∞–ª–∏ –≤—á–µ—Ä–∞ –≤ 10:00):**
```
timestamp: 2025-10-16 06:00
close: 49800  # –°–≤–µ—á–∞ –µ—â—ë –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞
```

**–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å–æ–±—Ä–∞–ª–∏ —Å–µ–≥–æ–¥–Ω—è –ø–æ—Å–ª–µ 12:00):**
```
timestamp: 2025-10-16 06:00  # –¢–û–¢ –ñ–ï timestamp
close: 50100  # –§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Å `keep='last'`:**
```
timestamp: 2025-10-16 06:00
close: 50100  # ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2:** –°–≤–µ—á–∞ —É–∂–µ –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞

**–û–±–µ –≤–µ—Ä—Å–∏–∏:**
```
timestamp: 2025-10-15 06:00
close: 48500  # –û–¥–∏–Ω–∞–∫–æ–≤–∞—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Å `keep='last'`:**
```
timestamp: 2025-10-15 06:00
close: 48500  # ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–¥—É–±–ª–∏–∫–∞—Ç —É–¥–∞–ª—ë–Ω)
```

---

## üìä –ò–ù–ö–†–ï–ú–ï–ù–¢–ê–õ–¨–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï

### –ê–ª–≥–æ—Ä–∏—Ç–º (—Å—Ç—Ä–æ–∫–∏ 133-168):

1. **–ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ** (–µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
   ```python
   old_df = pd.read_csv(output_file)
   ```

2. **–û–±—ä–µ–¥–∏–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ + –Ω–æ–≤—ã–µ**
   ```python
   combined_df = pd.concat([old_df, new_df], ignore_index=True)
   ```

3. **–£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã** (–æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏)
   ```python
   combined_df = combined_df.drop_duplicates(subset=['timestamp'], keep='last')
   ```

4. **–°–æ—Ä—Ç–∏—Ä—É–µ–º** –æ—Ç —Å—Ç–∞—Ä—ã—Ö –∫ –Ω–æ–≤—ã–º
   ```python
   combined_df = combined_df.sort_values('timestamp')
   ```

5. **–°–æ—Ö—Ä–∞–Ω—è–µ–º** –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   ```python
   combined_df.to_csv(output_file, index=False)
   ```

### –í—ã–≤–æ–¥:

```
Updated: 3000 -> 3004 (+4 new candles)
```

---

## ‚è∞ –í–†–ï–ú–ï–ù–ù–´–ï –ò–ù–¢–ï–†–í–ê–õ–´

### 6-—á–∞—Å–æ–≤—ã–µ —Å–≤–µ—á–∏:

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ Bybit (UTC):**
- `00:00 - 06:00` ‚Üí –°–≤–µ—á–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ `06:00`
- `06:00 - 12:00` ‚Üí –°–≤–µ—á–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ `12:00`
- `12:00 - 18:00` ‚Üí –°–≤–µ—á–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ `18:00`
- `18:00 - 00:00` ‚Üí –°–≤–µ—á–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ `00:00`

**–ü—Ä–∏–º–µ—Ä —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**

| –í—Ä–µ–º—è —Å–±–æ—Ä–∞ | –¢–µ–∫—É—â–∞—è —Å–≤–µ—á–∞ | –°–æ–±–∏—Ä–∞–µ–º –¥–æ | –ò—Å–∫–ª—é—á–∞–µ–º |
|-------------|---------------|-------------|-----------|
| 10:30 | 06:00-12:00 (–æ—Ç–∫—Ä—ã—Ç–∞) | 06:00 | –¢–µ–∫—É—â—É—é |
| 13:00 | 12:00-18:00 (–æ—Ç–∫—Ä—ã—Ç–∞) | 12:00 | –¢–µ–∫—É—â—É—é |
| 18:30 | 18:00-00:00 (–æ—Ç–∫—Ä—ã—Ç–∞) | 18:00 | –¢–µ–∫—É—â—É—é |

---

## üéØ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –¢–ï–ö–£–©–ï–ô –õ–û–ì–ò–ö–ò

### ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:
- –¢–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–≤–µ—á–∏ (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–µ–∂–¥—É —Å–±–æ—Ä–∞–º–∏
- –ú–æ–¥–µ–ª—å –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö

### ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- `keep='last'` –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–µ—á–∏ –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
- –î—É–±–ª–∏–∫–∞—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ò—Å—Ç–æ—Ä–∏—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –±–µ–∑ –ø–æ—Ç–µ—Ä—å

### ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å–≤–µ—á–∏)
- –ù–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é
- –ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (~5-10 –º–∏–Ω—É—Ç –¥–ª—è 583 –º–æ–Ω–µ—Ç)

---

## üìù –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –ü–µ—Ä–≤–∏—á–Ω—ã–π —Å–±–æ—Ä (–≤—Å–µ –º–æ–Ω–µ—Ç—ã, 2 –≥–æ–¥–∞):
```bash
python scripts/ai/collect_historical_data.py --all --days 730
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ~2920 —Å–≤–µ—á–µ–π –Ω–∞ –º–æ–Ω–µ—Ç—É (4 —Å–≤–µ—á–∏ √ó 730 –¥–Ω–µ–π)
- ~1,700,000 —Å–≤–µ—á–µ–π –¥–ª—è 583 –º–æ–Ω–µ—Ç
- –¢–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–≤–µ—á–∏

### –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–≤—Å–µ –º–æ–Ω–µ—Ç—ã, 30 –¥–Ω–µ–π):
```bash
python scripts/ai/collect_historical_data.py --all --days 30
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ~120 –Ω–æ–≤—ã—Ö —Å–≤–µ—á–µ–π –Ω–∞ –º–æ–Ω–µ—Ç—É (4 —Å–≤–µ—á–∏ √ó 30 –¥–Ω–µ–π)
- ~70,000 —Å–≤–µ—á–µ–π –¥–ª—è 583 –º–æ–Ω–µ—Ç
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –î—É–±–ª–∏–∫–∞—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è (–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏)

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### 1. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å–≤–µ—á–∏:

–¢–µ–∫—É—â–∞—è (–Ω–µ–∑–∞–∫—Ä—ã—Ç–∞—è) —Å–≤–µ—á–∞ **–ù–ï —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è**, —á—Ç–æ–±—ã:
- ‚úÖ –î–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏
- ‚úÖ –ú–æ–¥–µ–ª—å –æ–±—É—á–∞–ª–∞—Å—å –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω–∞—Ö
- ‚úÖ –ù–µ –±—ã–ª–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π –º–µ–∂–¥—É —Å–±–æ—Ä–∞–º–∏

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:

`keep='last'` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:
- ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å–≤–µ—á–µ–π (–µ—Å–ª–∏ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–±–æ—Ä–∞—Ö
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### 3. –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞:

Bybit –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **UTC**, –ø–æ—ç—Ç–æ–º—É:
- ‚ö†Ô∏è –£—á–∏—Ç—ã–≤–∞–π—Ç–µ —Å–≤–æ–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ
- ‚ö†Ô∏è –°–≤–µ—á–∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –ø–æ UTC –≥—Ä–∞–Ω–∏—Ü–∞–º
- ‚ö†Ô∏è –¢–µ–∫—É—â–∞—è —Å–≤–µ—á–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ UTC –≤—Ä–µ–º–µ–Ω–∏

---

## ‚úÖ –ò–¢–û–ì–û

**–õ–æ–≥–∏–∫–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ –¢–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–≤–µ—á–∏ (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π (–Ω–µ–∑–∞–∫—Ä—ã—Ç–æ–π) —Å–≤–µ—á–∏
- ‚úÖ –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (`keep='last'`)
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç —Å—Ç–∞—Ä—ã—Ö –∫ –Ω–æ–≤—ã–º
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- üéØ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è AI
- üöÄ –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- üí™ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

