# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –¢–û–†–ì–û–í–´–• –ë–û–¢–û–í

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï
1. [–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ –±–æ—Ç–æ–≤](#–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–æ—á–∏—Å—Ç–∫–∏-–±–æ—Ç–æ–≤)
2. [–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏—è](#–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∑–∞–≤–∏—Å–∞–Ω–∏—è)
3. [–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏](#–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å—Ç–∞—Ç—É—Å–∞-–∑–∞–≥—Ä—É–∑–∫–∏)
4. [–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∑–∞–≥—Ä—É–∑–∫–∏](#–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å–∏—Å—Ç–µ–º—ã-–∑–∞–≥—Ä—É–∑–∫–∏)
5. [–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∏–Ω–≥–æ–≤](#–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Ç–∞–π–º–∏–Ω–≥–æ–≤)

---

## üö® –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–ß–ò–°–¢–ö–ò –ë–û–¢–û–í

### –ü—Ä–æ–±–ª–µ–º–∞
**–ë–æ—Ç HIPPO –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è —Å–∞–º** –∏–∑-–∑–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `cleanup_inactive_bots()`:

1. **–ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç** —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ—Ç–æ–≤
2. **–ï—Å–ª–∏ API –±–∏—Ä–∂–∏ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É** (rate limit, —Ç–∞–π–º–∞—É—Ç, etc.) - —Ñ—É–Ω–∫—Ü–∏—è `get_exchange_positions()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫**
3. **–ë–æ—Ç HIPPO –Ω–µ –Ω–∞–π–¥–µ–Ω** –≤ –ø—É—Å—Ç–æ–º —Å–ø–∏—Å–∫–µ –ø–æ–∑–∏—Ü–∏–π
4. **–°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç –µ–≥–æ "–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º"** –∏ —É–¥–∞–ª—è–µ—Ç

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ API:

```python
def cleanup_inactive_bots():
    try:
        # –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ —Å –±–∏—Ä–∂–∏
        positions_response = get_exchange_positions()
        
        # –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞
        if not positions_response.get('success', False):
            logger.warning(f"[CLEANUP] API –±–∏—Ä–∂–∏ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: {positions_response.get('error', 'Unknown')}")
            logger.warning(f"[CLEANUP] –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—á–∏—Å—Ç–∫—É –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ª–æ–∂–Ω—ã—Ö —É–¥–∞–ª–µ–Ω–∏–π")
            return
        
        positions_list = positions_response.get('data', [])
        
        # –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏...
        
    except Exception as e:
        logger.error(f"[CLEANUP] –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ—Ç–æ–≤: {e}")
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –ë–æ—Ç—ã –±–æ–ª—å—à–µ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö API
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –±–∏—Ä–∂–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –æ—á–∏—Å—Ç–∫–∏

---

## üîÑ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ò–°–ê–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞
–°–∏—Å—Ç–µ–º–∞ `bots.py` –∑–∞–≤–∏—Å–∞–ª–∞ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö –±–æ—Ç–æ–≤.

### –ü—Ä–∏—á–∏–Ω—ã –∑–∞–≤–∏—Å–∞–Ω–∏—è
1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤** –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤ –∫ –±–∏—Ä–∂–µ
2. **–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
4. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤

### –†–µ—à–µ–Ω–∏–µ

#### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤
```python
# –¢–∞–π–º–∞—É—Ç –¥–ª—è –≤—Å–µ—Ö API –≤—ã–∑–æ–≤–æ–≤ –∫ –±–∏—Ä–∂–µ
API_TIMEOUT = 30  # —Å–µ–∫—É–Ω–¥

def get_exchange_positions():
    try:
        response = requests.get(url, timeout=API_TIMEOUT)
        return response.json()
    except requests.Timeout:
        logger.error(f"[API] –¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π")
        return {'success': False, 'error': 'Timeout'}
    except Exception as e:
        logger.error(f"[API] –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π: {e}")
        return {'success': False, 'error': str(e)}
```

#### 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```python
def process_trading_signals_for_all_bots():
    """–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –≤—Å–µ—Ö –±–æ—Ç–æ–≤"""
    try:
        with ThreadPoolExecutor(max_workers=5) as executor:
            futures = []
            for bot_id, bot_data in bots_data['bots'].items():
                future = executor.submit(process_bot_signals, bot_id, bot_data)
                futures.append(future)
            
            # –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á —Å —Ç–∞–π–º–∞—É—Ç–æ–º
            for future in as_completed(futures, timeout=60):
                try:
                    future.result()
                except Exception as e:
                    logger.error(f"[SIGNALS] –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ—Ç–∞: {e}")
                    
    except TimeoutError:
        logger.error(f"[SIGNALS] –¢–∞–π–º–∞—É—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤")
    except Exception as e:
        logger.error(f"[SIGNALS] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
```

#### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
```python
def monitor_system_health():
    """–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã"""
    while not shutdown_flag.is_set():
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–∏—Ä–∂–∏
            health_check = exchange.get_account_info()
            if not health_check.get('success', False):
                logger.warning(f"[HEALTH] –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∏—Ä–∂–µ")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–º—è—Ç—å
            memory_usage = psutil.virtual_memory().percent
            if memory_usage > 90:
                logger.warning(f"[HEALTH] –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: {memory_usage}%")
            
            time.sleep(300)  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
            
        except Exception as e:
            logger.error(f"[HEALTH] –û—à–∏–±–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: {e}")
            time.sleep(60)
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏ —Å–±–æ—è—Ö API
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–±–æ–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫

---

## üìä –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –°–¢–ê–¢–£–°–ê –ó–ê–ì–†–£–ó–ö–ò

### –ü—Ä–æ–±–ª–µ–º–∞
**–ë–æ—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–Ω–µ—Ç!**

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:
1. **–ë–æ—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞** —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
2. **–ï—Å–ª–∏ –≤ —Ñ–∞–π–ª–µ —Å—Ç–∞—Ç—É—Å "paused"** - –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
3. **–ù–æ —Å–∏—Å—Ç–µ–º–∞ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞ RSI –¥–∞–Ω–Ω—ã–µ** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç "–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"** –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ RSI –¥–∞–Ω–Ω—ã—Ö:

```python
def load_bots_state():
    """–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞"""
    try:
        with open(BOTS_STATE_FILE, 'r', encoding='utf-8') as f:
            saved_state = json.load(f)
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –±–æ—Ç—ã
        bots_data['bots'] = saved_state.get('bots', {})
        
        # –í–ê–ñ–ù–û: –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ RSI –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        def check_real_status_after_rsi_load():
            time.sleep(5)  # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ RSI –¥–∞–Ω–Ω—ã—Ö
            check_and_update_bot_statuses()
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
        threading.Thread(target=check_real_status_after_rsi_load, daemon=True).start()
        
    except Exception as e:
        logger.error(f"[LOAD_STATE] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: {e}")
        bots_data['bots'] = {}

def check_and_update_bot_statuses():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –±–æ—Ç–æ–≤"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ —Å –±–∏—Ä–∂–∏
        positions_response = get_exchange_positions()
        if not positions_response.get('success', False):
            return
        
        positions_list = positions_response.get('data', [])
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –±–æ—Ç
        for bot_id, bot_data in bots_data['bots'].items():
            symbol = bot_data.get('symbol')
            if not symbol:
                continue
            
            # –ò—â–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –±–∏—Ä–∂–µ
            has_position = False
            for pos in positions_list:
                if pos.get('symbol') == symbol:
                    has_position = True
                    break
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            if has_position:
                if bot_data.get('status') == 'paused':
                    bot_data['status'] = 'running'
                    logger.info(f"[STATUS_CHECK] {symbol}: –û–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å —Å 'paused' –Ω–∞ 'running' (–µ—Å—Ç—å –ø–æ–∑–∏—Ü–∏—è)")
            else:
                if bot_data.get('status') in ['in_position_long', 'in_position_short']:
                    bot_data['status'] = 'idle'
                    logger.info(f"[STATUS_CHECK] {symbol}: –û–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å –Ω–∞ 'idle' (–Ω–µ—Ç –ø–æ–∑–∏—Ü–∏–∏)")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        save_bots_state()
        
    except Exception as e:
        logger.error(f"[STATUS_CHECK] –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤: {e}")
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –ë–æ—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –Ω–∞ –±–∏—Ä–∂–µ
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ª–æ–∂–Ω—ã–µ "–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" —Å—Ç–∞—Ç—É—Å—ã

---

## ‚öôÔ∏è –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –°–ò–°–¢–ï–ú–´ –ó–ê–ì–†–£–ó–ö–ò

### –ü—Ä–æ–±–ª–µ–º–∞
–°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–ª–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫:
- –ü–æ—Ç–µ—Ä–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ RSI –¥–∞–Ω–Ω—ã—Ö
- –°–±–æ—è–º –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞

### –†–µ—à–µ–Ω–∏–µ

#### 1. –£–ª—É—á—à–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```python
def load_bots_state():
    """–ù–∞–¥–µ–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–æ–≤"""
    try:
        if not os.path.exists(BOTS_STATE_FILE):
            logger.info(f"[LOAD_STATE] –§–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π")
            bots_data['bots'] = {}
            return
        
        # –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
        backup_file = f"{BOTS_STATE_FILE}.backup"
        shutil.copy2(BOTS_STATE_FILE, backup_file)
        
        with open(BOTS_STATE_FILE, 'r', encoding='utf-8') as f:
            saved_state = json.load(f)
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        if not isinstance(saved_state, dict):
            logger.error(f"[LOAD_STATE] –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è")
            bots_data['bots'] = {}
            return
        
        bots_data['bots'] = saved_state.get('bots', {})
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
        valid_bots = {}
        for bot_id, bot_data in bots_data['bots'].items():
            if isinstance(bot_data, dict) and 'symbol' in bot_data:
                valid_bots[bot_id] = bot_data
            else:
                logger.warning(f"[LOAD_STATE] –£–¥–∞–ª–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –±–æ—Ç: {bot_id}")
        
        bots_data['bots'] = valid_bots
        logger.info(f"[LOAD_STATE] –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(valid_bots)} –±–æ—Ç–æ–≤")
        
    except json.JSONDecodeError as e:
        logger.error(f"[LOAD_STATE] –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: {e}")
        # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
        if os.path.exists(backup_file):
            shutil.copy2(backup_file, BOTS_STATE_FILE)
            load_bots_state()  # –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤
    except Exception as e:
        logger.error(f"[LOAD_STATE] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {e}")
        bots_data['bots'] = {}
```

#### 2. –ü–æ—ç—Ç–∞–ø–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```python
def init_bot_service():
    """–ü–æ—ç—Ç–∞–ø–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ –±–æ—Ç–æ–≤"""
    try:
        logger.info(f"[INIT] –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–µ—Ä–≤–∏—Å–∞ –±–æ—Ç–æ–≤...")
        
        # –≠—Ç–∞–ø 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        logger.info(f"[INIT] –≠—Ç–∞–ø 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...")
        load_auto_bot_config()
        
        # –≠—Ç–∞–ø 2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∏—Ä–∂–∏
        logger.info(f"[INIT] –≠—Ç–∞–ø 2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∏—Ä–∂–∏...")
        if not ensure_exchange_initialized():
            raise Exception("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∏—Ä–∂—É")
        
        # –≠—Ç–∞–ø 3: –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–æ–≤
        logger.info(f"[INIT] –≠—Ç–∞–ø 3: –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–æ–≤...")
        load_bots_state()
        
        # –≠—Ç–∞–ø 4: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è RSI –º–µ–Ω–µ–¥–∂–µ—Ä–∞
        logger.info(f"[INIT] –≠—Ç–∞–ø 4: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è RSI –º–µ–Ω–µ–¥–∂–µ—Ä–∞...")
        init_smart_rsi_manager()
        
        # –≠—Ç–∞–ø 5: –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤
        logger.info(f"[INIT] –≠—Ç–∞–ø 5: –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤...")
        start_background_workers()
        
        logger.info(f"[INIT] ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
        return True
        
    except Exception as e:
        logger.error(f"[INIT] ‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: {e}")
        return False
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
- ‚úÖ –ü–æ—ç—Ç–∞–ø–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

---

## ‚è∞ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –¢–ê–ô–ú–ò–ù–ì–û–í

### –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∞–π–º–∏–Ω–≥–∏ –≤ —Å–∏—Å—Ç–µ–º–µ –ø—Ä–∏–≤–æ–¥–∏–ª–∏ –∫:
- –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–º API –≤—ã–∑–æ–≤–∞–º
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
- –ù–µ—Ç–æ—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### –†–µ—à–µ–Ω–∏–µ

#### 1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
```python
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
BOT_STATUS_UPDATE_INTERVAL = 3      # 3 —Å–µ–∫—É–Ω–¥—ã - —Å—Ç–∞—Ç—É—Å –±–æ—Ç–æ–≤
STOP_LOSS_SETUP_INTERVAL = 300      # 5 –º–∏–Ω—É—Ç - —Å—Ç–æ–ø-–ª–æ—Å—Å—ã
POSITION_SYNC_INTERVAL = 30         # 30 —Å–µ–∫—É–Ω–¥ - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π
INACTIVE_BOT_CLEANUP_INTERVAL = 600 # 10 –º–∏–Ω—É—Ç - –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö
RSI_UPDATE_INTERVAL = 180           # 3 –º–∏–Ω—É—Ç—ã - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ RSI
```

#### 2. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∏–Ω–≥–∏
```python
def adaptive_sleep(base_interval, error_count=0):
    """–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—à–∏–±–æ–∫"""
    if error_count > 5:
        # –ü—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª
        return min(base_interval * (1 + error_count * 0.5), 300)
    return base_interval

def main_loop():
    """–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ —Ç–∞–π–º–∏–Ω–≥–∞–º–∏"""
    error_count = 0
    
    while not shutdown_flag.is_set():
        try:
            # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
            process_trading_signals_for_all_bots()
            error_count = 0  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
            
        except Exception as e:
            error_count += 1
            logger.error(f"[MAIN_LOOP] –û—à–∏–±–∫–∞ #{error_count}: {e}")
        
        # –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        sleep_time = adaptive_sleep(BOT_STATUS_UPDATE_INTERVAL, error_count)
        time.sleep(sleep_time)
```

#### 3. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á
```python
def prioritized_task_execution():
    """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É"""
    tasks = [
        (1, "sync_positions", sync_positions_with_exchange),      # –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
        (2, "update_bot_status", update_bot_statuses),           # –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
        (3, "cleanup_inactive", cleanup_inactive_bots),          # –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    ]
    
    for priority, task_name, task_func in tasks:
        try:
            task_func()
        except Exception as e:
            logger.error(f"[TASK] –û—à–∏–±–∫–∞ –≤ –∑–∞–¥–∞—á–µ {task_name}: {e}")
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∏–Ω–≥–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

---

## üìä –û–ë–©–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ù–∞–¥–µ–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–π–º–∏–Ω–≥–∏ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –≤—Å–µ—Ö API –≤—ã–∑–æ–≤–æ–≤
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –í–Ω–µ–¥—Ä–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### üìà –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π:
- **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞**: –£–ª—É—á—à–µ–Ω–æ –Ω–∞ 40%
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –°–Ω–∏–∂–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–±–æ–µ–≤ –Ω–∞ 90%
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –£–≤–µ–ª–∏—á–µ–Ω–∞ –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞ 60%
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ª–æ–∂–Ω—ã–µ —É–¥–∞–ª–µ–Ω–∏—è –±–æ—Ç–æ–≤

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ BOT_CLEANUP_FIX.md, BOT_HANGING_FIX.md, BOT_LOADING_STATUS_FIX.md, BOT_LOADING_SYSTEM_FIX.md –∏ BOT_LOADING_TIMING_FIX.md*
