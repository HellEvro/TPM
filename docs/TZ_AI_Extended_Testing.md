# AI Extended Testing & Simulation Upgrade Plan

## 1. Инвентаризация параметров
- Полная таблица ключей из `DEFAULT_AUTO_BOT_CONFIG` с указанием использования (боты, AI, не используется), метрики влияния (PnL, риск, сигналы) и допустимых диапазонов.
- Индивидуальные настройки (`individual_coin_settings`) должны поддерживать те же ключи + AI‑телеметрию (`ai_trained`, `ai_win_rate`, `ai_rating`, `ai_trades_count`, `ai_total_pnl`, `ai_trained_at`, `updated_at`).
- Формат выгрузки — Markdown/JSON-матрица «ключ → влияние/приоритет», чтобы исключить пропуски при дальнейшем расширении.

## 2. Унификация источника конфигурации для AI
- Добавить в `bots_modules.imports_and_globals` функцию получения единого слепка настроек (глобальные + overrides по монете).
- В `ai_trainer` и `ai_backtester_new` использовать только этот слепок; отказаться от локальных копий `DEFAULT_AUTO_BOT_CONFIG`.
- Расширить `indiv_settings` в `bots_modules/imports_and_globals`, чтобы любые поля (не только RSI/риск) корректно пишутся/читаются и сериализуются.
- Обновить валидаторы/сериализацию, чтобы новые поля не терялись при сохранении.

## 3. Расширение симулятора под защитные механизмы
- Вынести защитную логику (`break_even`, трейлинг, `max_position_hours`, `exit_scam` и др.) из `NewTradingBot` в переиспользуемые функции либо запустить бота в headless‑режиме.
- В `ai_trainer` отказаться от ручного расчёта PnL: дергать вынесенные функции/бот, чтобы симуляция учитывала все ограничения, как в бою.

## 4. Поддержка флагов и фильтров
- В симуляции применять чекбоксы `avoid_down_trend`, `enable_maturity_check`, `trading_enabled`, `use_test_server` и т.д. через подготовку датасета/блокировку сделок.
- Для временных фильтров/порогов (`RSI time filter`, `exit_scam`) использовать функции из `bots_modules.filters`, чтобы не дублировать логику.

## 5. Расширение оптимизатора
- Добавить параметризуемые «геномы» для всех новых ключей (границы, шаги) в оптимизаторе.
- В отчётах/логах отображать полный набор параметров, чтобы мониторинг фиксировал, какие настройки оптимизировались.
- При сохранении индивидуальных настроек писать весь пакет (включая новые поля) и логировать изменения по каждому ключу.

## 6. Тестовый контур
- Автотест: прогон симуляции на фиксированном датасете с включёнными/выключенными опциями и сравнение результатов с `NewTradingBot`.
- Smoke‑тест: обучение пары монет и проверка, что индивидуальные настройки содержат полный набор полей.

## 7. Статус тестирования
- Пока не выполнялось (логические правки). Тесты будут добавлены после реализации шагов выше.

