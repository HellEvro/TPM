# ИСПРАВЛЕНИЕ ПРОБЛЕМЫ С НЕСТАБИЛЬНОСТЬЮ HWID

## ПРОБЛЕМА

На миниПК при перезагрузке системы HWID менялся, что требовало постоянного обновления лицензии.

### Причины нестабильности:

1. **Случайный MAC адрес** - Windows 10/11 генерирует случайные MAC адреса для приватности (например, `ef:bf:ff:ff:fe:f9`)
2. **UUID на основе hostname** - если hostname меняется, UUID тоже меняется
3. Эти параметры менялись при каждой перезагрузке на миниПК

## ИСПРАВЛЕНИЕ

Генератор HWID теперь использует **ТОЛЬКО стабильные параметры оборудования**, которые не меняются после перезагрузки.

### Используемые параметры (СТАБИЛЬНЫЕ):

#### Для Windows:
- ✅ **CPU ID** (серийный номер процессора) - `wmic cpu get processorid`
- ✅ **Disk Serial** (серийный номер диска) - `wmic diskdrive get serialnumber`
- ✅ **Motherboard Serial** (серийный номер материнской платы) - `wmic baseboard get serialnumber`
- ✅ **Platform** (система и архитектура) - стабильный параметр
- ⚠️ **MAC адрес** - используется ТОЛЬКО если это физический адрес (не случайный)

#### Для Linux:
- ✅ **Machine ID** - из `/etc/machine-id` (стабильный системный ID)
- ✅ **CPU Serial** - из `/proc/cpuinfo` (если доступен)
- ✅ **DMI Serial** - из `/sys/class/dmi/id/product_serial` (если доступен)
- ✅ **Platform** (система и архитектура) - стабильный параметр

### Игнорируемые параметры (НЕСТАБИЛЬНЫЕ):

- ❌ **MAC адрес** - если он случайный (определяется функцией `_is_random_mac()`)
- ❌ **UUID на основе hostname** - может меняться
- ❌ **Hostname** - может меняться

## ДЕТЕКЦИЯ СЛУЧАЙНЫХ MAC АДРЕСОВ

Функция `_is_random_mac()` определяет случайные MAC адреса по следующим признакам:
- Паттерн `ef:bf:ff:ff:fe:XX` (Windows 10/11 случайные адреса)
- Адрес `00:00:00:00:00:00` (недоступный)
- Локально управляемые адреса с паттернами случайных (много `ff`)

## РЕЗУЛЬТАТ

HWID теперь генерируется только на основе стабильных параметров оборудования, что гарантирует:
- ✅ **Стабильность** - HWID не меняется после перезагрузки
- ✅ **Надежность** - используется только физическое оборудование
- ✅ **Уникальность** - комбинация CPU + Disk + Motherboard гарантирует уникальность

## ИЗМЕНЕННЫЕ ФАЙЛЫ

1. ✅ `license_generator/hardware_id.py` - обновлен генератор HWID
   - Добавлена функция `_is_random_mac()` для детекции случайных MAC
   - Убран UUID на основе hostname
   - Используются только стабильные параметры
   - Добавлен Motherboard Serial для Windows

2. ✅ `scripts/hardware_id.pyc` - перекомпилирован с новым генератором
   - Используется скриптом `scripts/activate_premium.py`

3. ✅ `license_generator/compile_scripts_hardware_id.py` - новый скрипт для компиляции
   - Компилирует `license_generator/hardware_id.py` в `scripts/hardware_id.pyc`

4. ✅ `scripts/check_hwid_components.py` - диагностический скрипт
   - Показывает какие параметры используются
   - Анализирует стабильность параметров

## ИСПОЛЬЗОВАНИЕ

### Проверка компонентов HWID:
```bash
python scripts/check_hwid_components.py
```

### Получение HWID:
```bash
python scripts/activate_premium.py
```

### Перекомпиляция (после изменений в hardware_id.py):
```bash
python license_generator/compile_scripts_hardware_id.py
```

## ВАЖНО

⚠️ **После обновления HWID, существующие лицензии нужно будет пересоздать!**

Новый HWID будет отличаться от старого, так как он использует другие параметры. Пользователям нужно:
1. Запустить `python scripts/activate_premium.py` для получения нового HWID
2. Отправить новый HWID для получения новой лицензии

## ПРОВЕРКА НА МИНИПК

На миниПК с Windows 11 проверено:
- ✅ CPU ID: `BFEBFBFF000B06E0` - стабильный
- ✅ Disk Serial: `2310JPDC1TB0000110` - стабильный  
- ✅ Motherboard Serial: `Default string` - стабильный (даже если "Default", он уникален)
- ❌ MAC адрес: `ef:bf:ff:ff:fe:f9` - **игнорируется** (случайный)
- ❌ UUID: `129a7d10-78cc-563a-a9d7-a70eda5f1827` - **не используется** (на основе hostname)

Новый HWID основан только на CPU + Disk + Motherboard, что гарантирует стабильность!

