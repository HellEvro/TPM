# ๐๏ธ ะััะธัะตะบัััะฐ InfoBot Bots Service

ะะพะดัะพะฑะฝะพะต ะพะฟะธัะฐะฝะธะต ะฐััะธัะตะบัััั ัะธััะตะผั ะฟะพัะปะต ัะฐะทะฑะธะตะฝะธั ะฝะฐ ะผะพะดัะปะธ.

---

## ๐ ะะฑัะฐั ะฐััะธัะตะบัััะฐ

```
InfoBot Project
โโโ app.py (5000)           โ ะัะฝะพะฒะฝะพะน ะฒะตะฑ-ะธะฝัะตััะตะนั
โโโ bots.py (5001)          โ ะกะตัะฒะธั ัะฟัะฐะฒะปะตะฝะธั ะฑะพัะฐะผะธ โญ
โโโ protector.py (5002)     โ ะะฐัะธัะฝัะน ัะตัะฒะธั
โ
โโโ bot_engine/             โ ะะฑัะฐั ะฑะธะฑะปะธะพัะตะบะฐ ัะพัะณะพะฒะพะน ะปะพะณะธะบะธ
โ   โโโ utils/              โ RSI/EMA ััะธะปะธัั
โ   โโโ filters.py          โ ะะฑัะธะต ัะธะปัััั
โ   โโโ maturity_checker.py โ ะัะพะฒะตัะบะฐ ะทัะตะปะพััะธ
โ   โโโ trading_bot.py      โ ะะฐะทะพะฒัะน ะบะปะฐัั ะฑะพัะฐ
โ   โโโ ...
โ
โโโ bots_modules/           โ ะะพะดัะปะธ ัะฟะตัะธัะธัะฝัะต ะดะปั bots.py โญ ะะะะะ!
โ   โโโ imports_and_globals.py
โ   โโโ calculations.py
โ   โโโ maturity.py
โ   โโโ filters.py
โ   โโโ bot_class.py
โ   โโโ sync_and_cache.py
โ   โโโ workers.py
โ   โโโ init_functions.py
โ   โโโ api_endpoints.py
โ
โโโ exchanges/              โ ะะดะฐะฟัะตัั ะดะปั ะฑะธัะถ
โ   โโโ bybit_exchange.py
โ   โโโ binance_exchange.py
โ   โโโ ...
โ
โโโ data/                   โ ะะตััะธััะตะฝัะฝัะต ะดะฐะฝะฝัะต
    โโโ bots_state.json
    โโโ auto_bot_config.json
    โโโ mature_coins.json
    โโโ optimal_ema.json
```

---

## ๐ ะะฐะทะฑะธะตะฝะธะต bots.py

### ะะพ ัะฐะทะฑะธะตะฝะธั:
```
bots.py (7678 ัััะพะบ)
โโโ ะะผะฟะพััั
โโโ ะะพะฝััะฐะฝัั
โโโ ะะปะพะฑะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต
โโโ 135 ััะฝะบัะธะน
โโโ 1 ะบะปะฐัั (NewTradingBot)
โโโ 60+ API endpoints
```

### ะะพัะปะต ัะฐะทะฑะธะตะฝะธั:
```
bots.py (215 ัััะพะบ) - ะณะปะฐะฒะฝัะน ะบะพะพัะดะธะฝะฐัะพั
โโโ bots_modules/ (10 ะผะพะดัะปะตะน ะฟะพ ะปะพะณะธัะตัะบะธะผ ะฑะปะพะบะฐะผ)
```

---

## ๐งฉ ะะพะดัะปัะฝะฐั ััััะบัััะฐ

### ะัะธะฝัะธะฟ ัะฐะทะดะตะปะตะฝะธั:

```
bots_modules/
โ
โโโ ๐ฆ ะกะปะพะน ะดะฐะฝะฝัั ะธ ะบะพะฝัะธะณััะฐัะธะธ
โ   โโโ imports_and_globals.py  โ ะะผะฟะพััั, ะบะพะฝััะฐะฝัั, Flask app
โ   โโโ sync_and_cache.py       โ ะัั, ัะพััะพัะฝะธะต, ัะธะฝััะพะฝะธะทะฐัะธั
โ
โโโ ๐งฎ ะกะปะพะน ะฒััะธัะปะตะฝะธะน
โ   โโโ calculations.py         โ RSI/EMA ัะฐััะตัั
โ   โโโ maturity.py            โ ะัะพะฒะตัะบะฐ ะทัะตะปะพััะธ ะผะพะฝะตั
โ   โโโ optimal_ema.py         โ ะะฟัะธะผะฐะปัะฝัะต EMA ะฟะตัะธะพะดั
โ
โโโ ๐ฏ ะกะปะพะน ะฑะธะทะฝะตั-ะปะพะณะธะบะธ
โ   โโโ filters.py             โ ะคะธะปัััั ัะธะณะฝะฐะปะพะฒ
โ   โโโ bot_class.py           โ ะะปะฐัั ัะพัะณะพะฒะพะณะพ ะฑะพัะฐ
โ   โโโ workers.py             โ ะคะพะฝะพะฒัะต ะฒะพัะบะตัั
โ
โโโ ๐ง ะกะปะพะน ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
โ   โโโ init_functions.py      โ ะะฝะธัะธะฐะปะธะทะฐัะธั ัะธััะตะผั
โ
โโโ ๐ ะกะปะพะน API
    โโโ api_endpoints.py       โ REST API (60+ endpoints)
```

---

## ๐ ะะทะฐะธะผะพะดะตะนััะฒะธะต ะผะพะดัะปะตะน

### ะัะฐั ะทะฐะฒะธัะธะผะพััะตะน:

```
bots.py
  โ
  โโ imports_and_globals.py (ะฑะฐะทะพะฒัะน, ะธะผะฟะพััะธััะตััั ะฟะตัะฒัะผ)
  โ    โโ Flask app
  โ    โโ ะะพะฝััะฐะฝัั (RSI_OVERSOLD, EMA_FAST, ...)
  โ    โโ ะะปะพะฑะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต (bots_data, coins_rsi_data, ...)
  โ    โโ GlobalState (ะดะปั ะพะฑะผะตะฝะฐ exchange ะผะตะถะดั ะผะพะดัะปัะผะธ)
  โ
  โโ calculations.py
  โ    โโ ะัะฟะพะปัะทัะตั: TREND_CONFIRMATION_BARS (ะธะท imports_and_globals)
  โ    โโ ะัะฟะพะปัะทัะตั: get_optimal_ema_periods (ะธะท optimal_ema)
  โ
  โโ maturity.py
  โ    โโ ะัะฟะพะปัะทัะตั: bots_data_lock, bots_data (ะธะท imports_and_globals)
  โ    โโ ะัะฟะพะปัะทัะตั: calculate_rsi_history (ะธะท calculations)
  โ
  โโ optimal_ema.py (ะฝะตะทะฐะฒะธัะธะผัะน)
  โ
  โโ filters.py
  โ    โโ ะัะฟะพะปัะทัะตั: calculate_rsi, analyze_trend (ะธะท calculations)
  โ    โโ ะัะฟะพะปัะทัะตั: check_coin_maturity (ะธะท maturity)
  โ    โโ ะัะฟะพะปัะทัะตั: get_optimal_ema_periods (ะธะท optimal_ema)
  โ    โโ ะัะฟะพะปัะทัะตั: RSI_OVERSOLD, BOT_STATUS (ะธะท imports_and_globals)
  โ
  โโ bot_class.py
  โ    โโ ะัะฟะพะปัะทัะตั: bots_data, BOT_STATUS (ะธะท imports_and_globals)
  โ    โโ ะัะฟะพะปัะทัะตั: check_rsi_time_filter (ะธะท filters)
  โ
  โโ sync_and_cache.py
  โ    โโ ะัะฟะพะปัะทัะตั: bots_data, exchange (ะธะท imports_and_globals)
  โ    โโ ะัะฟะพะปัะทัะตั: get_exchange() (GlobalState)
  โ    โโ ะัะฟะพะปัะทัะตั: ensure_exchange_initialized (ะธะท init_functions)
  โ
  โโ workers.py
  โ    โโ ะัะฟะพะปัะทัะตั: shutdown_flag, bots_data (ะธะท imports_and_globals)
  โ    โโ ะัะฟะพะปัะทัะตั: save_bots_state (ะธะท sync_and_cache)
  โ    โโ ะัะฟะพะปัะทัะตั: process_auto_bot_signals (ะธะท filters)
  โ
  โโ init_functions.py
  โ    โโ ะัะฟะพะปัะทัะตั: exchange, system_initialized (ะธะท imports_and_globals)
  โ    โโ ะัะฟะพะปัะทัะตั: set_exchange() (GlobalState)
  โ    โโ ะัะฟะพะปัะทัะตั: load_mature_coins (ะธะท maturity)
  โ    โโ ะัะฟะพะปัะทัะตั: load_all_coins_rsi (ะธะท filters)
  โ
  โโ api_endpoints.py
       โโ ะัะฟะพะปัะทัะตั: bots_app (ะธะท imports_and_globals)
       โโ ะัะฟะพะปัะทัะตั: save_auto_bot_config (ะธะท sync_and_cache)
       โโ ะัะฟะพะปัะทัะตั: get_effective_signal (ะธะท filters)
       โโ ะะตะณะธัััะธััะตั 60+ Flask routes
```

---

## ๐ ะะธะทะฝะตะฝะฝัะน ัะธะบะป ัะธััะตะผั

### 1. ะะฐะฟััะบ (`python bots.py`)
```
1. ะัะพะฒะตัะบะฐ ะฟะพััะฐ 5001
2. ะะผะฟะพัั ะฒัะตั ะผะพะดัะปะตะน (from bots_modules.X import *)
3. ะะฐัััะพะนะบะฐ ะปะพะณะธัะพะฒะฐะฝะธั
4. ะะฝะธัะธะฐะปะธะทะฐัะธั (init_bot_service):
   โโ ะะฐะณััะทะบะฐ ะบะพะฝัะธะณััะฐัะธะน
   โโ ะะฝะธัะธะฐะปะธะทะฐัะธั ะฑะธัะถะธ (ะะะะะซะ!)
   โโ ะะฐะฟััะบ Smart RSI Manager
   โโ ะกะธะฝััะพะฝะธะทะฐัะธั ั ะฑะธัะถะตะน
   โโ ะัะพะฒะตัะบะฐ ะบะพะฝัะปะธะบัะพะฒ ะฟะพะทะธัะธะน
5. ะะฐะฟััะบ ัะพะฝะพะฒัั ะฒะพัะบะตัะพะฒ:
   โโ Auto Save Worker (ะบะฐะถะดัะต 30 ัะตะบ)
   โโ Auto Bot Worker (ัะตะถะธะผ ะพะถะธะดะฐะฝะธั)
6. ะะฐะฟััะบ Flask ัะตัะฒะตัะฐ (ะฑะปะพะบะธััััะธะน ะฒัะทะพะฒ)
```

### 2. ะะฐะฑะพัะฐ
```
โโ Flask Thread โโโโโโโโโโโโโโโโโโโโโ
โ  ะะฑัะฐะฑะฐััะฒะฐะตั HTTP ะทะฐะฟัะพัั        โ
โ  GET /api/bots                    โ
โ  POST /api/bots/create            โ
โ  PUT /api/auto-bot/config         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ Smart RSI Manager Thread โโโโโโโโโ
โ  ะะฑะฝะพะฒะปัะตั RSI ะบะฐะถะดัะต 5 ะผะธะฝัั     โ
โ  ะัะทัะฒะฐะตั load_all_coins_rsi()    โ
โ  583 ะผะพะฝะตัั โ RSI ะดะฐะฝะฝัะต          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ Auto Save Worker Thread โโโโโโโโโโ
โ  ะกะพััะฐะฝัะตั ัะพััะพัะฝะธะต ะบะฐะถะดัะต 30 ัะตะบโ
โ  bots_state.json                  โ
โ  mature_coins.json                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ Auto Bot Worker Thread โโโโโโโโโโโ
โ  ะัะพะฒะตััะตั enabled ะบะฐะถะดัะต N ัะตะบ   โ
โ  ะัะปะธ enabled=True:               โ
โ    โโ process_auto_bot_signals()  โ
โ  ะะฑะฝะพะฒะปัะตั ะบัั ะฟะพะทะธัะธะน            โ
โ  ะัะพะฒะตััะตั ััะพะฟ-ะปะพััั             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ Async Processor Thread โโโโโโโโโโโ
โ  ะัะธะฝััะพะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ัะธะณะฝะฐะปะพะฒ   โ
โ  ะกะธะฝััะพะฝะธะทะฐัะธั ะฟะพะทะธัะธะน (1 ะผะธะฝ)    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 3. ะััะฐะฝะพะฒะบะฐ (Ctrl+C)
```
1. Signal handler ะฟะตัะตัะฒะฐััะฒะฐะตั SIGINT
2. ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั shutdown_flag
3. ะัะทัะฒะฐะตั cleanup_bot_service():
   โโ ะััะฐะฝะฐะฒะปะธะฒะฐะตั async processor
   โโ ะกะพััะฐะฝัะตั ัะพััะพัะฝะธะต ะฑะพัะพะฒ
   โโ ะกะพััะฐะฝัะตั ะทัะตะปัะต ะผะพะฝะตัั
4. os._exit(0) - ะผะณะฝะพะฒะตะฝะฝัะน ะฒััะพะด
```

---

## ๐ API ะฐััะธัะตะบัััะฐ

### ะัะพะบัะธ app.py โ bots.py (ะฟะพัั 5000 โ 5001)

ะัะธ ะดะพัััะฟะต ะบ UI ัะตัะตะท `app.py` (ะฟะพัั 5000) ััะพะฝัะตะฝะด ะธัะฟะพะปัะทัะตั `BOTS_SERVICE_URL = window.location.origin`, ะฟะพััะพะผั ะทะฐะฟัะพัั ะบ `/api/bots/*` ะธะดัั ะฒ app.py. **app.py ะฟัะพะบัะธััะตั** ะธั ะฒ bots.py (ะฟะพัั 5001) ัะตัะตะท `call_bots_service()`.

**ะะปััะตะฒัะต ะฟัะพะบัะธ (ัะตะฒัะฐะปั 2025):**
- `GET /api/bots/list` (timeout 30 ัะตะบ), `GET /api/bots/active-detailed`, `GET /api/bots/delisted-coins`
- `GET /api/bots/history`, `POST /api/bots/history/clear`, `POST /api/bots/history/demo`
- `GET/POST /api/bots/fullai-config`
- `GET /api/bots/analytics`, `/api/bots/analytics/fullai`, `/api/bots/analytics/rsi-audit`, `ai-context`, `ai-reanalyze`, `sync-from-exchange`

ะะพะปะฝัะน ัะฟะธัะพะบ ะผะฐัััััะพะฒ โ ะฒ `app.py` (ะฟะพะธัะบ `@app.route('/api/bots`).

### REST API (ะฟะพัั 5001, bots.py)
```
GET  /api/status              โ ะกัะฐััั ัะตัะฒะธัะฐ
GET  /api/bots/list           โ ะกะฟะธัะพะบ ะฑะพัะพะฒ
POST /api/bots/create         โ ะกะพะทะดะฐัั ะฑะพัะฐ
POST /api/bots/control        โ ะฃะฟัะฐะฒะปะตะฝะธะต ะฑะพัะพะผ (start/stop/pause)
GET  /api/bots/active-detailed โ ะะตัะฐะปะธ ะฐะบัะธะฒะฝัั ะฑะพัะพะฒ
GET  /api/bots/history        โ ะััะพัะธั ะดะตะนััะฒะธะน
...ะธ ะพััะฐะปัะฝัะต endpoints ะฒ bots_modules/api_endpoints.py
```

ะะพะปะฝัะน ัะฟะธัะพะบ: `bots_modules/api_endpoints.py`, `docs/Bots_TZ.md`

---

## ๐พ ะฅัะฐะฝะตะฝะธะต ะดะฐะฝะฝัั

### ะคะฐะนะปั ัะพััะพัะฝะธั:
```
data/
โโโ bots_state.json          โ ะกะพััะพัะฝะธะต ะฒัะตั ะฑะพัะพะฒ
โ   โโ bots: {}              โ ะกะปะพะฒะฐัั ะฑะพัะพะฒ ะฟะพ ัะธะผะฒะพะปะฐะผ
โ   โโ auto_bot_config: {}   โ ะะฐัััะพะนะบะธ ะฐะฒัะพะฑะพัะฐ
โ   โโ global_stats: {}      โ ะะฑัะฐั ััะฐัะธััะธะบะฐ
โ
โโโ auto_bot_config.json     โ ะะพะฝัะธะณััะฐัะธั ะฐะฒัะพะฑะพัะฐ
โ   โโ enabled: false        โ ะะบะปััะตะฝ ะปะธ ะฐะฒัะพะฑะพั
โ   โโ max_concurrent: 5     โ ะะฐะบั. ะพะดะฝะพะฒัะตะผะตะฝะฝัั ะฑะพัะพะฒ
โ   โโ rsi_long_threshold: 29
โ   โโ rsi_short_threshold: 71
โ
โโโ mature_coins.json        โ ะัะตะปัะต ะผะพะฝะตัั (ะฟะพััะพัะฝะฝะพะต ััะฐะฝะธะปะธัะต)
โ   โโ {symbol: {maturity_data, timestamp}}
โ
โโโ optimal_ema.json         โ ะะฟัะธะผะฐะปัะฝัะต EMA ะฟะตัะธะพะดั
โ   โโ {symbol: {ema_short, ema_long, accuracy}}
โ
โโโ rsi_cache.json           โ ะัั RSI ะดะฐะฝะฝัั
โ   โโ {coins: {}, last_update, ...}
โ
โโโ process_state.json       โ ะกะพััะพัะฝะธะต ะฟัะพัะตััะพะฒ
โ   โโ smart_rsi_manager: {}
โ   โโ auto_bot_worker: {}
โ   โโ auto_save_worker: {}
โ
โโโ system_config.json       โ ะกะธััะตะผะฝัะต ะฝะฐัััะพะนะบะธ
    โโ bot_status_update_interval: 30
    โโ position_sync_interval: 30
    โโ rsi_update_interval: 300
```

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั ะธ ะธะทะพะปััะธั

### ะัะธะฝัะธะฟ ัะฐะทะดะตะปะตะฝะธั ะพัะฒะตัััะฒะตะฝะฝะพััะธ:

1. **bot_engine/** - ะะตัะตะธัะฟะพะปัะทัะตะผะฐั ะฑะธะฑะปะธะพัะตะบะฐ
   - ะะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัััั ะฒ app.py, protector.py
   - ะะฑัะฐั ัะพัะณะพะฒะฐั ะปะพะณะธะบะฐ
   - ะะตะทะฐะฒะธัะธะผะฐั ะพั Flask

2. **bots_modules/** - ะกะฟะตัะธัะธัะฝัะต ะผะพะดัะปะธ bots.py
   - ะขะพะปัะบะพ ะดะปั ัะตัะฒะธัะฐ ะฑะพัะพะฒ
   - Flask API endpoints
   - ะะพัะบะตัั ะฐะฒัะพัะพััะฐะฝะตะฝะธั
   - ะะฝัะตะณัะฐัะธั ั ะพัะฝะพะฒะฝัะผ ัะตัะฒะธัะพะผ

### GlobalState pattern:

```python
# imports_and_globals.py
class GlobalState:
    exchange = None
    smart_rsi_manager = None
    system_initialized = False

_state = GlobalState()

def get_exchange():
    return _state.exchange

def set_exchange(exch):
    _state.exchange = exch
```

**ะะฐัะตะผ?** ะงัะพะฑั ะธะทะผะตะฝะตะฝะธั ะฒ `exchange` ะฑัะปะธ ะฒะธะดะฝั **ะฒะพ ะฒัะตั ะผะพะดัะปัั**.

---

## ๐ ะะพัะพะบะธ ะฒัะฟะพะปะฝะตะฝะธั

### ะะปะฐะฒะฝัะน ะฟะพัะพะบ (Main Thread):
- ะะฝะธัะธะฐะปะธะทะฐัะธั ัะธััะตะผั
- ะะฐะฟััะบ Flask ัะตัะฒะตัะฐ (ะฑะปะพะบะธััะตั)

### Flask Worker Threads:
- ะะฑัะฐะฑะพัะบะฐ HTTP ะทะฐะฟัะพัะพะฒ
- ะฃะฟัะฐะฒะปะตะฝะธะต ะฑะพัะฐะผะธ ัะตัะตะท API

### Smart RSI Manager Thread:
- ะะฑะฝะพะฒะปะตะฝะธะต RSI ะบะฐะถะดัะต 5 ะผะธะฝัั
- ะััะปะตะถะธะฒะฐะฝะธะต ะทะฐะบัััะธั ัะฒะตัะตะน 6H
- ะัะทะพะฒ ัะพัะณะพะฒัั ัะธะณะฝะฐะปะพะฒ

### Auto Save Worker Thread:
- ะกะพััะฐะฝะตะฝะธะต ัะพััะพัะฝะธั ะบะฐะถะดัะต 30 ัะตะบัะฝะด
- ะัะพะผะฐัะฝะฐั ะทะฐะฟะธัั ั retry

### Auto Bot Worker Thread:
- ะัะพะฒะตัะบะฐ enabled ััะฐัััะฐ
- ะัะปะธ enabled=True โ ัะพะทะดะฐะฝะธะต ะฑะพัะพะฒ ะฟะพ ัะธะณะฝะฐะปะฐะผ
- ะะฑะฝะพะฒะปะตะฝะธะต ะบััะฐ ะฟะพะทะธัะธะน
- ะัะพะฒะตัะบะฐ ััะพะฟ-ะปะพััะพะฒ

### Async Processor Thread:
- ะัะธะฝััะพะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ัะธะณะฝะฐะปะพะฒ
- ะกะธะฝััะพะฝะธะทะฐัะธั ะฟะพะทะธัะธะน ะบะฐะถะดัั ะผะธะฝััั
- ะะฟัะธะผะธะทะฐัะธั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

---

## ๐ ะะพัะพะบะพะฑะตะทะพะฟะฐัะฝะพััั

### ะะปะพะบะธัะพะฒะบะธ (Locks):

```python
# ะะปะพะฑะฐะปัะฝัะต ะฑะปะพะบะธัะพะฒะบะธ
bots_data_lock            โ ะะฐัะธัะฐะตั bots_data
rsi_data_lock             โ ะะฐัะธัะฐะตั coins_rsi_data
bots_cache_lock           โ ะะฐัะธัะฐะตั bots_cache_data
mature_coins_lock         โ ะะฐัะธัะฐะตั mature_coins_storage
coin_processing_lock      โ ะฃะฟัะฐะฒะปัะตั coin_processing_locks

# ะะปะพะบะธัะพะฒะบะธ ะดะปั ะบะฐะถะดะพะน ะผะพะฝะตัั
coin_processing_locks = {
    'BTC': Lock(),
    'ETH': Lock(),
    ...
}
```

**ะะฐัะตะผ?** ะัะตะดะพัะฒัะฐัะตะฝะธะต race conditions ะฟัะธ ะพะดะฝะพะฒัะตะผะตะฝะฝะพะผ ะดะพัััะฟะต ะธะท ัะฐะทะฝัั ะฟะพัะพะบะพะฒ.

---

## ๐ก ะะทะฐะธะผะพะดะตะนััะฒะธะต ั ะฑะธัะถะตะน

```
Bots Service
     โ
ExchangeFactory.create_exchange('BYBIT', api_key, secret)
     โ
BybitExchange (ะฐะดะฐะฟัะตั)
     โ
Bybit API (REST)
     โโ get_positions()
     โโ place_order()
     โโ cancel_order()
     โโ set_trading_stop()
     โโ get_chart_data()
```

### Retry ะปะพะณะธะบะฐ:
- Max 3 ะฟะพะฟััะบะธ ะดะปั ะบัะธัะธัะฝัั ะพะฟะตัะฐัะธะน
- ะญะบัะฟะพะฝะตะฝัะธะฐะปัะฝะฐั ะทะฐะดะตัะถะบะฐ (0.1s โ 0.2s โ 0.4s)
- Rate limit handling

---

## ๐ฏ ะขะพัะณะพะฒะฐั ะปะพะณะธะบะฐ

### ะกัะตะผะฐ ะฟัะธะฝััะธั ัะตัะตะฝะธั:

```
1. Smart RSI Manager ะพะฑะฝะพะฒะปัะตั RSI
   โ
2. load_all_coins_rsi() ะทะฐะณััะถะฐะตั ะดะฐะฝะฝัะต
   โ
3. ะะปั ะบะฐะถะดะพะน ะผะพะฝะตัั:
   get_coin_rsi_data()
   โโ calculate_rsi(prices)           โ RSI ะทะฝะฐัะตะฝะธะต
   โโ analyze_trend_6h()              โ UP/DOWN/NEUTRAL
   โโ check_coin_maturity()           โ ะัะตะปะฐั/ะะตะทัะตะปะฐั (ะดะปั UI, ะะ ะฑะปะพะบะธััะตั)
   โโ perform_enhanced_rsi_analysis() โ ะะฐััะธัะตะฝะฝัะน ะฐะฝะฐะปะธะท
   โ๏ธ ExitScam ะธ RSI Time Filter ะะ ะฟัะพะฒะตัััััั ะทะดะตัั!
   โ
4. get_effective_signal(coin)
   โโ RSI <= 29 โ ENTER_LONG
   โโ RSI >= 71 โ ENTER_SHORT
   โโ RSI >= 65 (ะฒ ะปะพะฝะณะต) โ EXIT_LONG
   โโ RSI <= 35 (ะฒ ัะพััะต) โ EXIT_SHORT
   โ
5. ะัะปะธ Auto Bot enabled:
   process_auto_bot_signals()
   โโ ะัะปะธ ัะธะณะฝะฐะป ะตััั โ create_bot(symbol)
   โ
6. NewTradingBot ัะฟัะฐะฒะปัะตั ะฟะพะทะธัะธะตะน
   โโ _enter_position(side) ะฒัะทัะฒะฐะตััั
   โ  โโ โ ะะกะ ะคะะะฌะขะะซ ะฟัะพะฒะตัััััั ะทะดะตัั:
   โ  โ  โโ apply_entry_filters() ะฟัะพะฒะตััะตั:
   โ  โ  โ  โโ Global switches
   โ  โ  โ  โโ Scope (whitelist/blacklist)
   โ  โ  โ  โโ Trend (avoid_down_trend/avoid_up_trend)
   โ  โ  โ  โโ Maturity (enable_maturity_check)
   โ  โ  โ  โโ RSI Time Filter (rsi_time_filter_enabled)
   โ  โ  โ  โโ ExitScam (exit_scam_enabled)
   โ  โ  โ     โโ ๐ค AI Anomaly Detection (ะตัะปะธ ะฒะบะปััะตะฝ)
   โ  โ  โโ ๐ค AI Optimal Entry Detection (ะตัะปะธ ะฒะบะปััะตะฝ)
   โ  โ  โโ ๐ค AI Risk Management - ะฐะดะฐะฟัะฐัะธั ัะฐะทะผะตัะฐ
   โ  โ  โโ ะัะบัััะธะต ะฟะพะทะธัะธะธ ะฝะฐ ะฑะธัะถะต
   โ  โโ ๐ค AI Risk Management - ะฐะดะฐะฟัะฐัะธั ััะพะฟ-ะปะพััะฐ
   โ  โโ ะฃััะฐะฝะพะฒะบะฐ stop-loss
   โ  โโ Trailing stop ะฟัะธ ะฟัะธะฑัะปะธ
   โ  โโ ะะฐะบัััะธะต ะฟะพ RSI ะฒััะพะดะฐ
```

**ะะปััะตะฒะพะน ะฟัะธะฝัะธะฟ:** ะัะต ะฑะปะพะบะธััััะธะต ัะธะปัััั (ExitScam, RSI Time Filter, Maturity) ะฟัะพะฒะตัััััั ะขะะะฌะะ ะฟัะธ ะฒัะพะดะต ะฒ ะฟะพะทะธัะธั ะฒ `_enter_position()`, ะฐ ะฝะต ะดะปั ะฒัะตั ะผะพะฝะตั ะฟะพััะพัะฝะฝะพ. ะญัะพ ะพะฟัะธะผะธะทะฐัะธั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะธ ะฟัะฐะฒะธะปัะฝะฐั ะปะพะณะธะบะฐ ัะฐะฑะพัั ัะธะปัััะพะฒ ะบะฐะบ "ะพััะตะบะฐัะตะปั".

---

## ๐ ะะฑะฝะพะฒะปะตะฝะธะต ะดะฐะฝะฝัั

### RSI Update Flow:

```
Smart RSI Manager (ะบะฐะถะดัะต 5 ะผะธะฝัั)
  โ
load_all_coins_rsi(exchange)
  โ
ะะฐัะฐะปะปะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ (ThreadPoolExecutor, 3 ะฒะพัะบะตัะฐ)
  โโ ะะฐะบะตั 1: 50 ะผะพะฝะตั
  โโ ะะฐะบะตั 2: 50 ะผะพะฝะตั
  ...
  โโ ะะฐะบะตั 12: 33 ะผะพะฝะตัั
  โ
ะะปั ะบะฐะถะดะพะน ะผะพะฝะตัั:
  get_coin_rsi_data(symbol, exchange)
    โโ exchange.get_chart_data('6h', '30d')
    โโ calculate_rsi(closes, 14)
    โโ analyze_trend_6h(symbol)
    โโ check_coin_maturity_with_storage()
    โโ perform_enhanced_rsi_analysis()
  โ
ะะฝะบัะตะผะตะฝัะฐะปัะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต coins_rsi_data
  โ
save_rsi_cache() - ัะพััะฐะฝะตะฝะธะต ะฒ ัะฐะนะป
```

---

## ๐ก ะะปััะตะฒัะต ะฟะฐััะตัะฝั

### 1. GlobalState ะดะปั shared state
```python
_state = GlobalState()
exchange = set_exchange(new_exchange)  # ะะธะดะฝะพ ะฒะตะทะดะต
```

### 2. Lock-based synchronization
```python
with bots_data_lock:
    bot = bots_data['bots'][symbol]
```

### 3. Try-except ะดะปั ะธะผะฟะพััะพะฒ
```python
try:
    from bots_modules.X import func
except ImportError:
    def func(): pass  # ะะฐะณะปััะบะฐ
```

### 4. Daemon threads
```python
thread = threading.Thread(target=worker, daemon=True)
thread.start()  # ะะฒัะพะผะฐัะธัะตัะบะธ ะพััะฐะฝะฐะฒะปะธะฒะฐะตััั ะฟัะธ ะฒััะพะดะต
```

---

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะะฟัะธะผะธะทะฐัะธะธ:

1. **ะะฐัะฐะปะปะตะปัะฝะฐั ะทะฐะณััะทะบะฐ RSI** (3 ะฒะพัะบะตัะฐ)
2. **ะะฝะบัะตะผะตะฝัะฐะปัะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต** (ะฑะฐััะฐะผะธ ะฟะพ 50 ะผะพะฝะตั)
3. **ะััะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั** (RSI, ะทัะตะปะพััั, optimal EMA)
4. **ะะพะดะฐะฒะปะตะฝะธะต ะฟะพะฒัะพััััะธััั ะปะพะณะพะฒ** (should_log_message)
5. **ะัะธะฝััะพะฝะฝัะน ะฟัะพัะตััะพั** ะดะปั ััะถะตะปัั ะพะฟะตัะฐัะธะน
6. **Connection pooling** (100 ะฟัะปะพะฒ ร 200 ัะพะตะดะธะฝะตะฝะธะน)

### ะะตััะธะบะธ:

- **ะะฐะณััะทะบะฐ 583 ะผะพะฝะตั:** ~2-3 ะผะธะฝััั
- **ะะฑะฝะพะฒะปะตะฝะธะต RSI:** ~1-2 ะผะธะฝััั (ะธะฝะบัะตะผะตะฝัะฐะปัะฝะพ)
- **RAM usage:** ~500MB ะฒ ะพะฑััะฝะพะผ ัะตะถะธะผะต
- **CPU usage:** <5% ะฒ ัะตะถะธะผะต ะพะถะธะดะฐะฝะธั

---

## ๐ฏ ะกะปะตะดัััะธะต ัะฐะณะธ

ะะปั ะฑะพะปะตะต ะฟะพะดัะพะฑะฝะพะน ะธะฝัะพัะผะฐัะธะธ:
- **ะะพะดัะปะธ:** [MODULES.md](MODULES.md)
- **ะกะธััะตะผะฝัะน ะพะฑะทะพั:** [SYSTEM_OVERVIEW.md](SYSTEM_OVERVIEW.md)
- **API ะฑะพัะพะฒ:** [Bots_TZ.md](Bots_TZ.md) (ัะฐะทะดะตะป API), `bots_modules/api_endpoints.py`
- **ะััะพัะธั:** [CHANGELOG.md](CHANGELOG.md)

